import{f as O,b as v,ab as T,h as l,K as V,_ as B,J as E,C as S,i as k,D as N}from"./BKD1GJOj.js";function Y(e,t){let n=null,o=l;var r;if(l){n=k;for(var s=N(document.head);s!==null&&(s.nodeType!==V||s.data!==e);)s=B(s);if(s===null)E(!1);else{var i=B(s);s.remove(),S(i)}}l||(r=document.head.appendChild(O()));try{v(()=>t(r),T)}finally{o&&(E(!0),S(n))}}const m=(e,t)=>t.some(n=>e instanceof n);let P,x;function A(){return P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _(){return x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D=new WeakMap,I=new WeakMap,y=new WeakMap;function F(e){const t=new Promise((n,o)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{n(u(e.result)),r()},i=()=>{o(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)});return y.set(t,e),t}function W(e){if(D.has(e))return;const t=new Promise((n,o)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{n(),r()},i=()=>{o(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});D.set(e,t)}let b={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return D.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return u(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function L(e){b=e(b)}function K(e){return _().includes(e)?function(...t){return e.apply(g(this),t),u(this.request)}:function(...t){return u(e.apply(g(this),t))}}function R(e){return typeof e=="function"?K(e):(e instanceof IDBTransaction&&W(e),m(e,A())?new Proxy(e,b):e)}function u(e){if(e instanceof IDBRequest)return F(e);if(I.has(e))return I.get(e);const t=R(e);return t!==e&&(I.set(e,t),y.set(t,e)),t}const g=e=>y.get(e);function H(e,t,{blocked:n,upgrade:o,blocking:r,terminated:s}={}){const i=indexedDB.open(e,t),f=u(i);return o&&i.addEventListener("upgradeneeded",a=>{o(u(i.result),a.oldVersion,a.newVersion,u(i.transaction),a)}),n&&i.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),f.then(a=>{s&&a.addEventListener("close",()=>s()),r&&a.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),f}const J=["get","getKey","getAll","getAllKeys","count"],$=["put","add","delete","clear"],h=new Map;function M(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(h.get(t))return h.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,r=$.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(r||J.includes(n)))return;const s=async function(i,...f){const a=this.transaction(i,r?"readwrite":"readonly");let c=a.store;return o&&(c=c.index(f.shift())),(await Promise.all([c[n](...f),r&&a.done]))[0]};return h.set(t,s),s}L(e=>({...e,get:(t,n,o)=>M(t,n)||e.get(t,n,o),has:(t,n)=>!!M(t,n)||e.has(t,n)}));const z=["continue","continuePrimaryKey","advance"],C={},w=new WeakMap,p=new WeakMap,G={get(e,t){if(!z.includes(t))return e[t];let n=C[t];return n||(n=C[t]=function(...o){w.set(this,p.get(this)[t](...o))}),n}};async function*Q(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,G);for(p.set(n,t),y.set(n,g(t));t;)yield n,t=await(w.get(n)||t.continue()),w.delete(n)}function j(e,t){return t===Symbol.asyncIterator&&m(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&m(e,[IDBIndex,IDBObjectStore])}L(e=>({...e,get(t,n,o){return j(t,n)?Q:e.get(t,n,o)},has(t,n){return j(t,n)||e.has(t,n)}}));let d=null;async function U(){return d||(d=await H("locanote",1,{upgrade(e,t,n,o){if(e.objectStoreNames.contains("users")||e.createObjectStore("users",{keyPath:"id"}).createIndex("by-username","username"),!e.objectStoreNames.contains("credentials")){const r=e.createObjectStore("credentials",{keyPath:"id"});r.createIndex("by-user","userId"),r.createIndex("by-type","type")}if(!e.objectStoreNames.contains("notes")){const r=e.createObjectStore("notes",{keyPath:"id"});r.createIndex("by-user","userId"),r.createIndex("by-tag","tags",{multiEntry:!0})}e.objectStoreNames.contains("tags")||e.createObjectStore("tags",{keyPath:"id"}).createIndex("by-user","userId")}}),d)}async function Z(){return d||await U(),d}export{Z as g,Y as h};
